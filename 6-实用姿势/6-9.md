# 9. AMD 免驱独显优化

## 温度传感器

从 Radeon VII 开始，Apple 停止直接报告温度，需要 kexts 介入并实施该功能。对于 Vega 10 及更早版本，其他工具已经可以显示 GPU 温度，而无需额外的 kext。

所需项目地址：https://github.com/aluveitie/RadeonSensor

支持从 Radeon HD 7000 系列到 RX 6000 系列的所有 GPU。

先看下这个项目里面下载下来的几个文件：

- **RadeonSensor.kext**：读取GPU温度所需，需要Lilu
- **SMCRadeonGPU.kext**：可以选择用于将 GPU 温度导出到 VirtualSMC 以供监控工具读取
- **RadeonGadget.app**：在状态栏中显示 GPU 温度，只需要加载RadeonSensor.kext

使用方法也比较简单，将 RadeonSensor.kext 和 SMCRadeonGPU.kext 拷贝到 EFI/OC/Kexts 目录下，然后在 config.plist 里面启用即可：

![](https://image.3001.net/images/20220213/16447475011422.jpg) 

重启电脑即可生效。

- 使用 Sensei 可以正常查看 GPU 温度：

![](https://image.3001.net/images/20220213/16447476349590.png) 

- 使用 iStat Menus 也可以正常查看 GPU 温度：

![](https://image.3001.net/images/20220213/16447477725090.png) 

不想安装  SMCRadeonGPU.kext 的话，使用自带的 app 也是可看的，虽然有点丑：

![](https://image.3001.net/images/20220213/16447478651792.png)   

## 性能优化

### 前言

独显不是已经免驱了吗？为啥要进行优化呢？这个网上也有很多种说法，黑苹果这块确实是酱紫的，没有绝对权威的言论，所以国光我结合网上说法，猜测出以下几种原因：

1. 苹果自制的驱动比如 W5700X 是苹果自家的 iMac 系列使用的，性能要强于兼容性的 eGPU 驱动，比如 RX 5700XT（绝大多数黑果用户使用）
2. 苹果官方的驱动比较保守限制了 GPU 的实力，比如以 XT 结尾的显卡基本上体制都是不错的，拥有不错的超频性能，提升潜力巨大

所以理论上 RX 5000/6000 系列的显卡在 macOS 下都是有不小的提升空间的，像之前的 5700XT 远景的 xjn819 大佬就分享过优化的方法（详情可见参考链接），但是 RX 6000 系列的资料就比较少了，国光也只是零零散散收集到了一些姿势，现在下面本文就以 **AMD Radeon RX 6600 XT** 为例，来实际演示一下 6600 XT 优化的全过程。 

### 信息收集

以下信息我们后续可能用得到，所以先进行一个基础的信息收集。首先就是 ROM 的版本号，这个可以在系统信息的「图形化/显示器」里面直接看到：

![image-20220213212804491](imgs/image-20220213212804491.png) 

我们在 Windows 下使用 GPU-Z 也是可以看到这个 ROM 版本号的，不过得是在老版本的 GPU-Z 才可以，下图中右边这老版本显示的 「The board ID」就是我们要找的 ROM 版本号：

![](https://image.3001.net/images/20220213/16447592113646.jpg)   

ROM修正版：	**113-3E4480U-S6L** 

根据白苹果的专业卡[泄露的信息](https://funnyinterestingcool.com/viewtopic.php?t=300)，我们整理一个表格，这个表格后面可以参考使用：

| **显卡名称**              | **OpenCL** | **Metal** | **ROM修正版**      | **VBIOS版本**          | **Option ROM版本**     | **EFI驱动程序版本** |
| ------------------------- | ---------- | --------- | ------------------ | ---------------------- | ---------------------- | ------------------- |
| Intel UHD 630             | 4784       | 5254      | N/A                | N/A                    | N/A                    | N/A                 |
| AMD Radeon Pro 560X       | 17601      | 18718     | **113-C9**80AL-075 | **113-C9**7501U-005    | **113-C9**7501U-005    | 01.A1.075/01.01.075 |
| AMD Radeon Pro 5300M      | 26933      | 26458     | **113-D3220**E-190 | **113-D3220**7P1-019   | **113-D3220**7P1-019   | 01.A1.190           |
| AMD Radeon Pro 5500M      | 29642      | 28598     | **113-D3220**E-190 | **113-D3220**6U1-019   | **113-D3220**6U1-019   | 01.A1.190/01.01.190 |
| AMD Radeon Pro 570X       | 31017      | 32718     | **113-D0008A**-042 | **113-D0008A**14GL-003 | **113-D0008A**14GL-003 | 01.01.042           |
| AMD Radeon Pro 575        | 33255      | 34908     | **113-D000**AA-931 | **113-D000**1A1P-025   | **113-D000**1A1P-025   | 01.00.931           |
| AMD Radeon Pro 580X       | 39027      | 40914     | **113-C944**0C-171 | **113-C944**A1XT-014   | **113-C944**A1XT-014   | 01.01.183           |
| AMD Radeon Pro W5700X     | 69971      | 76249     | **113-D186**0W-213 | **113-D186**A2XT-019   | **113-D186**A2XT-019   | 01.01.200           |
| AMD Radeon Pro W6800X     | 99492      | 133582    | **113-D417**1N-436 | **113-D417**A1XL-021   | **113-D417**A1XL-021   | 01.01.270           |
| AMD Radeon PRO W6800X Duo | 102146     | 139493    | **113-D417**1X-436 | **113-D417**A1DXL-021  | **113-D417**A1DXL-021  | 01.01.270           |
| AMD Radeon PRO W6900X     | 118243     | 171448    | **113-D417**1P-436 | **113-D417**A1XT-021   | **113-D417**A1XT-021   | 01.01.270           |

## 性能测试

### 环境信息

本次测试的一些环境信息：macOS 12.2.1 + i7-10700 + 64GB 2667MHz + 蓝宝石 RX 6600XT 白金版

| 软件名        | 版本信息 |
| ------------- | -------- |
| Final Cut Pro | 10.6.1   |
| Compressor    | 4.6      |

### 新建项目

首先点击「文件」-「新建」-「项目」，新建一个 4K 60 的项目，主要参数细节如下：

![image-20220215124630658](imgs/image-20220215124630658.png)  

然后在「字幕和发生器」变栏中选择「发生器」搜索「云」发生器，然后拖入到时间轴：

![](https://image.3001.net/images/20220215/1644900620455.jpg)

### 导出测试

因为 Final Cut Pro 可能会后台自己就渲染了，这里我们选择「文件」-「发送到 Compressor」-「新建批处理」：

![](https://image.3001.net/images/20220215/16449023266915.jpg) 

然后选择左侧的「YouTube 和 Facebook」-「最高 4K」拖入到我们 Final Cut Pro 发过来的项目上：

![](https://image.3001.net/images/20220215/164490254283.png) 

最后点击右下角的「开始批处理」，最后我们可以看到整个导出的时间：

![](https://image.3001.net/images/20220215/16449026554499.png) 

导出的视频默认在用户文件夹下面的「影片」文件下：

![](https://image.3001.net/images/20220215/16449027279313.png)  

### 最终结果

| 说明                                         | 第1次              | 第2次              | 平均时间           | 显卡负载     |
| -------------------------------------------- | ------------------ | ------------------ | ------------------ | ------------ |
| 仿冒 W6900X + 解锁功耗墙 + 显存超频          | 04 分 22 秒        | 04 分 19 秒（27%） | 04 分 21 秒        |              |
| 仿冒 W6900X                                  | 04 分 23 秒（27%） | 04 分 21 秒（27%） | 04 分 22 秒        |              |
| RX 6600XT + EFI Version + 零散的信息         | 04 分 20 秒（27%） | 04 分 19 秒（27%） | 04 分 20 秒        |              |
| RX 6600XT 原生数据                           | 04 分 39 秒（19%） | 04 分 41 秒（19%） | 04 分 40 秒        | 核显轻度工作 |
| 不正确的 ROM 号、EFI + 解锁功耗墙 + 显存超频 | 04 分 43 秒（19%） | 04 分 46 秒（19%） | 04 分 45 秒（19%） | 核显轻度工作 |
| RX 6600XT + 只有 EFI Version                 | 04 分 44 秒（20%） |                    |                    |              |
| RX 6600XT + EFI Version + ???                | 04 分 20 秒（27%） |                    |                    |              |

很明显的负载占用高低：

![](https://image.3001.net/images/20220216/16449437126641.png)

核显参与 + 独显变弱：

![](https://image.3001.net/images/20220216/16449437099365.png) 



Geekbench 后台跑分 + 导出，时间变长 5 分 09 秒、跑分只有 3w 多，但是占用确实提高了：

![](https://image.3001.net/images/20220216/16449442029245.png)     

## 参考链接

- [Asrock Radeon RX 5500 XT Challenger D 8G OC 注入优化](https://github.com/huijiewei/ASRock-Z390m-ITX-ac-Opencore/blob/master/Resources/5500XT/README.md)
- [Hackintosh - AsRock Z490 Phantom Gaming ITX/TB3 - intel Core 10850k - OpenCorePkg](https://github.com/Hush-vv/Hackintosh-AsRock-Z490-Phantom-Gaming-ITX-TB3-intel-10850k-OpenCorePkg)
- [远景论坛：xjn819 - 6900XT及苹果自家显示器相关](https://bbs.pcbeta.com/viewthread-1890015-1-1.html)
- [远景论坛：xjn819 - 5700xt 专享优化贴（我写完了）](https://bbs.pcbeta.com/forum.php?mod=viewthread&tid=1839725)
- [AMD Radeon PRO W6800X Duo and W6900X - macOS System Information](https://funnyinterestingcool.com/viewtopic.php?t=300)

## 支持一下

在这个喧嚣浮躁的时代，坚持写博客输出原创文章的人还有多少呢？写博客感觉一直是用爱发电的状态......

如果你恰巧财力雄厚，感觉本文对你有所帮助的话，可以考虑打赏一下本文，用以维持高昂的服务器运营费用（域名费用、服务器费用、CDN 费用等）

<table>
    <tr>
        <td>微信
            <center><img src="https://image.3001.net/images/20200421/1587449920128.jpg " width="70%"></center>
        </td>
        <td width="50%">
          支付宝
            <center><img src="https://image.3001.net/images/20200421/15874503376388.jpg" width="70%"></center>
        </td>
    </tr>
</table>


国光我也写了一个打赏页面用以感谢支持我的朋友，详情请看 [打赏列表 | 国光](https://www.sqlsec.com/dashang.html)



