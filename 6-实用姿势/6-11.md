# 11. macOS 下触屏驱动

## 前言

最近一直想入手 XPS 13 7390 二合一 或者 XPS 13 9300 笔记本，这两款携带的是目前黑苹果可以黑的最高版本的 CPU 了，而且颜值都挺高的，就是价格不便宜。不过经过冷静分析，发现我貌似只馋他们的 4k 触控屏，所以就想了一下，为啥我不直接去买一个 4k 触控便携显示器呢，而且价格便宜很多，2333 于是我就真的这么做了，这篇文章也就诞生了。

![](https://image.3001.net/images/20220305/16464737072727.jpg) 

## 默认情况

macOS 底层是不支持触控的，所以这个触屏默认情况下只能单指点击，就像一个鼠标一样，体验可以说很差了。但是卖我这个屏幕的是一个小姐姐，她之前是搭配 Macmini 使用的，我不是很理解她为啥买这样一个支持 10点触控的屏幕，却在 macOS 默认只能单指操作的情况下使用。

从小姐姐晒的图片我貌似也理解了：

![](https://image.3001.net/images/20220305/16464743909986.jpeg) 

这个显示器的左侧接口从上到下分别是：

- **Micro-USB**
  - 供电
- **Type-C**
  - 供电
- **Type-C**
  - 一线通同传投屏
  - 反向 USB 供电
  - 触控 USB 协议
- **标准 HDMI** 
  - 非 Mirco HDMI
  - 支持 4k 60hz

从图上貌似小姐姐她一直都没有外接第三个接口，所以触屏功能可能她一直就没有正经用过，怪不得要出掉这个显示器呢。

扯得有点多，先来看下 macOS 下这个触控屏的工作情况，可以看到识别到底层的触控芯片为 ILITEK-TP：

![](https://image.3001.net/images/20220305/16464769438886.png)

ILITEK芯片电容式触控控制器是为满足更轻松的业务领域而开发的，它是台湾 ILITEK 公司提供的2511/2302/2312芯片，兼容10.4-32寸的电容式触摸屏，提供经济的触摸解决方案。

## 加载触屏驱动

说到 macOS 触屏驱动，实际上我们经典的 I2C 触控板驱动本身也是支持触屏的，原项目地址为：

https://github.com/VoodooI2C/VoodooI2C/

很多经典的黑苹果机型，比如 XPS 系列也就使用这个项目驱动的。

废话不多说，我们这个台式机黑苹果想要驱动触控屏的话也很简单：

1. `VoodooI2C.kext` 和` VoodooI2CHID.kext` 放到 `EFI/OC/Kexts` 目录下
2. 使用 OCC 按照如下图的顺序加载：

![](https://image.3001.net/images/20220305/16464752859502.png) 

然后重启即可，最终 10 点触摸可以在 macOS 下完美工作（虽然 macOS 用不到 10 点手势）：

![](https://image.3001.net/images/20220305/16464755783361.jpg) 

不过这触控屏实际上是这种情况下单指操作是模拟触控笔，鼠标跟随手指，多指操作模拟妙控板，基本上妙控板的手势全部支持：

![](https://image.3001.net/images/20220305/16464762537969.png) 

基本上可以完成妙控板的大多数功能了。

> 多屏幕操作因为鼠标跟随手指的原因，可以辅助功能开启「三指拖移」

## 白苹果驱动姿势

上面操作通过 OC 来操作很简单，但是白苹果下没有 OC 该怎么呢？实际上也非常简单，就是使用命令行去手动记载对应的 kexts 即可。

首先下载最新的驱动版本：https://github.com/VoodooI2C/VoodooI2C/releases

删除掉其他无关紧要的 Kexts，只保留 `VoodooI2C.kext` 和 `VoodooI2CHID.kext` 

![](https://image.3001.net/images/20220305/16464873056837.png) 

接下来进入终端操作：

```bash
# 修改 kexts 所有者
➜  sudo chown -R root:wheel VoodooI2C*
 
# 添加执行权限
➜  sudo chmod -R 755 VoodooI2C*
 
# 加载 Kexts
➜  sudo kextload -v VoodooI2C*
```

此时应该会弹出「系统扩展已更新」的提示：

![](https://image.3001.net/images/20220305/16464874572041.png) 

打开设置里面的「安全与隐私」，点击允许：



![image-20220305213801994](https://image.3001.net/images/20220305/16464874834128.png)  

接着根据提示重启电脑即可。

重启后回到 Kexts 命令下继续执行加载命令：

```bash
# 加载 Kexts
➜  sudo kextload -v VoodooI2C*
```

输入下面命令查看 Kexts 的加载状态：

```bash
➜  VoodooI2C-2.7 sudo dmesg|grep Voodoo
```

出现类似下图的情况即表示 Kexts 加载成功：

![image-20220305213930013](imgs/image-20220305213930013.png) 

但是此时你的触控屏依然不支持多指手势，我们拔插一下 USB 协议的数据线重新看下日志看看：

```bash
➜  VoodooI2C-2.7 sudo dmesg|grep Voodoo
```

可以看到日志明显变化了，检测到了我们的显示器：

![](https://image.3001.net/images/20220305/16464877106505.png)  

此时你的触屏显示器多指手势应该在白苹果下也可以正常工作了。

## 支持一下

在这个喧嚣浮躁的时代，坚持写博客输出原创文章的人还有多少呢？写博客感觉一直是用爱发电的状态......

如果你恰巧财力雄厚，感觉本文对你有所帮助的话，可以考虑打赏一下本文，用以维持高昂的服务器运营费用（域名费用、服务器费用、CDN 费用等）

<table>
    <tr>
        <td>微信
            <center><img src="https://image.3001.net/images/20200421/1587449920128.jpg " width="70%"></center>
        </td>
        <td width="50%">
          支付宝
            <center><img src="https://image.3001.net/images/20200421/15874503376388.jpg" width="70%"></center>
        </td>
    </tr>
</table>

国光我也写了一个打赏页面用以感谢支持我的朋友，详情请看 [打赏列表 | 国光](https://www.sqlsec.com/dashang.html)



