# 2. 准备 ACPI

## 基本概念

### APCI

高级配置与电源接口（Advanced Configuration and Power Interface），是 1997 年由英特尔、微软、东芝共同提出、制定的操作系统电源管理、硬件配置接口，ACPI 定义了系统固件 BIOS 或 UEFI 和操作系统之间的硬件抽象接口。

它帮助操作系统合理控制和分配计算机硬件设备的电量，有 了 ACPI ，操作系统可以根据设备实际情况，根据需要把不同的硬件设备关闭。 

它主要涵盖的功能包括：

1. System power management（系统电源管理）
2. Device power management（设备电源管理）
3. Processor power management（处理器电源管理）
4. Device and processor performance management（设备及处理器性能管理）
5. Configuration / Plug and Play（配置/即插即用）
6. System Events（系统事件）
7. Battery management（电池管理）
8. Thermal management（温度管理）
9. Embedded Controller（嵌入式控制器）
10. SMBus Controller（SMBus控制器）

在计算机应用平台，ACPI 越来越重要。ACPI 由很多表组成，包括：RSDP，SDTH，RSDT，FADT，FACS，**DSDT**，**SSDT**，MADT，SBST，XSDT，ECDT，SLIT，SRAT。其中 **DSDT** 就是它的一个重要的描述表。

### DSDT 、SSDT

正如上面所说，DSDT 和 SSDT 是 ACPI 规范的一部分，概述了硬件设备，如 USB 控制器、CPU 线程、嵌入式控制器、系统时钟等。

DSDT（差分系统描述表）可以被视为包含大部分信息的主体

SSDT（辅助系统描述表）传递的信息较少

可以将 DSDT 视为建筑蓝图，其中 SSDT 是概述项目额外细节的便签

### Why？为什么要知道这些

macOS 可能对 DSDT 中存在的设备非常挑剔，因此我们需要纠正它。macOS 正常工作需要修正的主要设备：

- **EC**

  - 嵌入式控制器
  - 非苹果的机型都在其 DSDT 中公开了一个 EC，但是通常与 macOS 不兼容，可能会导致恐慌，因此需要对 macOS 隐藏。
  - 对于笔记本电脑，实际的嵌入式控制器仍然需要启用电池和热键才能工作，并且重命名 EC 还会导致 Windows 出现问题，因此最好在不禁用真正的嵌入式控制器的情况下创建假 EC。

- **Plugin type**

  - 插件类型
  - 允许使用 XCPM 在 Intel Haswell 以及更新架构的 CPU上提供本地 CPU 电源管理，这个不适合 AMD
  
- **AWAC system clock**

  - AWAC 系统时钟
  - 因为 macOS 无法与 AWAC 时钟通信，因此这要求我们要么强制使用传统 RTC 时钟，要么在不可用的情况下为 macOS 创建一个假的时钟来玩

- **NVRAM SSDT**

  - 真正的 300 系列主板（非 Z370）不会在 ACPI 中将 FW 芯片声明为 MMIO，因此内核会忽略 UEFI 内存映射声明的 MMIO 区域。这个 SSDT 带回了 NVRAM 支持

- **Backlight SSDT**

  - 用于修复笔记本电脑上的背光控制支持

- **GPIO SSDT**

  - 用于允许 VoodooI2C 连接，仅适用于笔记本电脑

- **XOSI SSDT**

  - 用于将 OSI 调用重新路由到此 SSDT，主要用于诱使我们的硬件认为其启动 Windows，以便我们获得更好的触控板支持

- **IRQ SSDT and ACPI patches**

  - 用于修复 DSDT 中的 IRQ 冲突，主要用于笔记本电脑。SSDT Time 独占
  - 注意 Skylake 和较新的 CPU 很少有 IRQ 冲突，这主要在 Broadwell 和较旧的系统上使用

## 常见 ACPI 组合

ACPI 可以自己手动编译，也可以下载别人编译好的，虽然自己编译是最完美的，但是需要一定的学习门槛，所以小白用户还是建议下载编译好的 SSDT 文件即可。

下面可以根据自己的机型，参考下文，下载属于自己的 ACPI 文件即可。

## 黑苹果 ACPI 大全？

